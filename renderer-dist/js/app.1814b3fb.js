(function(t){function e(e){for(var o,a,r=e[0],l=e[1],c=e[2],d=0,f=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(f.length)f.shift()();return s.push.apply(s,c||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,r=1;r<n.length;r++){var l=n[r];0!==i[l]&&(o=!1)}o&&(s.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},i={app:0},s=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="../renderer-dist/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=e,r=r.slice();for(var c=0;c<r.length;c++)e(r[c]);var u=l;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"27fc":function(t,e,n){"use strict";n("3c15")},"3c15":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("c740"),n("a434"),n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("Header",{attrs:{msg:"Welcome to Your Vue.js App"}}),n("Body")],1)},s=[],a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header"},[n("div",{staticClass:"header-row"},[n("span",{class:{"is-online":t.isOnline}},[t._v(t._s(t.isOnline?"已连接":"未连接"))]),n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#dddddd"},on:{change:t.handleSwitchChange},model:{value:t.isOnline,callback:function(e){t.isOnline=e},expression:"isOnline"}}),n("el-checkbox-group",{attrs:{size:"small"},model:{value:t.checkProtocals,callback:function(e){t.checkProtocals=e},expression:"checkProtocals"}},t._l(t.protocals,(function(e){return n("el-tooltip",{key:e.name,staticClass:"item",attrs:{effect:"dark",content:e.desc,placement:"bottom"}},[n("el-checkbox-button",{attrs:{label:e.name}},[t._v(t._s(e.name))])],1)})),1),n("el-checkbox",{staticStyle:{"background-color":"white"},attrs:{label:"SYSU内部转发",border:"",size:"small"},on:{change:t.handleInlanChange},model:{value:t.inLan,callback:function(e){t.inLan=e},expression:"inLan"}})],1),n("div",{staticClass:"header-row"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.customBindsDialogVisible=!0}}},[t._v("添加自定义绑定")]),n("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){t.tokenDialogVisible=!0}}},[t._v("修改Token")]),n("span",[t._v("Token: ")]),n("span",{staticStyle:{"user-select":"auto"}},[t._v(t._s(t.token||"未设置"))])],1),n("el-dialog",{attrs:{top:"20px",title:"请输入Token",visible:t.tokenDialogVisible,modal:""},on:{"update:visible":function(e){t.tokenDialogVisible=e}}},[n("div",{staticClass:"dialog-footer",attrs:{slot:"title"},slot:"title"},[t._v("请输入Token")]),n("el-input",{attrs:{placeholder:"Token",size:"small"},model:{value:t.token,callback:function(e){t.token=e},expression:"token"}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleChangeToken}},[t._v("确 定")])],1)],1),n("el-dialog",{attrs:{top:"20px",title:"添加自定义绑定",visible:t.customBindsDialogVisible,modal:""},on:{"update:visible":function(e){t.customBindsDialogVisible=e}}},[n("div",{staticClass:"dialog-footer",attrs:{slot:"title"},slot:"title"},[t._v("添加自定义绑定")]),n("el-input",{attrs:{placeholder:"名称",size:"small"},model:{value:t.customBindInput.label,callback:function(e){t.$set(t.customBindInput,"label",e)},expression:"customBindInput.label"}}),n("el-input",{attrs:{placeholder:"穿透主机ip/domain",size:"small"},model:{value:t.customBindInput.host,callback:function(e){t.$set(t.customBindInput,"host",e)},expression:"customBindInput.host"}}),n("el-input",{attrs:{placeholder:"穿透主机端口",size:"small"},model:{value:t.customBindInput.port,callback:function(e){t.$set(t.customBindInput,"port",e)},expression:"customBindInput.port"}}),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.handleAddCustomBind}},[t._v("确 定")])],1)],1)],1)},r=[],l=n("e504"),c=l["a"],u=(n("27fc"),n("2877")),d=Object(u["a"])(c,a,r,!1,null,"04e8ec52",null),f=d.exports,p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container"},[n("el-table",{staticStyle:{width:"calc(100vw - 18px)",margin:"auto","border-radius":"5px"},attrs:{data:t.tableData,height:"calc(100vh - 103px)"}},[n("el-table-column",{attrs:{prop:"label",label:"名称"}}),n("el-table-column",{attrs:{prop:"host",label:"主机"}}),n("el-table-column",{attrs:{prop:"port",label:"本地端口"}}),n("el-table-column",{attrs:{prop:"remotePort",label:"远程端口",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.remotePort&&-1!==e.row.remotePort?(t.inLan?"s.data-online.link":"data-online.link")+":"+e.row.remotePort:"未绑定")+" ")]}}])}),n("el-table-column",{attrs:{label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){return t.deleteBind(e.row)}}},[t._v("删除")])]}}])})],1)],1)},b=[],h={name:"Body",created:function(){},computed:{tableData:function(){return this.$store.state.binds},inLan:function(){return this.$store.state.inLan}},methods:{deleteBind:function(t){this.$store.commit("removeBind",t.label),console.log(t)}},beforeDestroy:function(){},data:function(){return{}}},m=h,v=Object(u["a"])(m,p,b,!1,null,"27c317b0",null),k=v.exports,g=(n("0fae"),{name:"App",components:{Header:f,Body:k}}),T=g,S=(n("034f"),Object(u["a"])(T,i,s,!1,null,null,null)),y=S.exports,P=n("5c96"),w=n.n(P),B=n("94ea");o["default"].use(B["a"]);var O=new B["a"].Store({state:{binds:[],inLan:!0},mutations:{addBind:function(t,e){t.binds.push(e)},removeBind:function(t,e){var n=t.binds.findIndex((function(t){return t.label===e}));-1!==n&&t.binds.splice(n,1)},replaceBinds:function(t,e){t.binds=e},toggleInLan:function(t,e){t.inLan=e}}});o["default"].config.productionTip=!1,o["default"].use(w.a),new o["default"]({render:function(t){return t(y)},store:O}).$mount("#app")},"85ec":function(t,e,n){},d959:function(t,e,n){"use strict";n.d(e,"a",(function(){return f}));n("96cf");var o=n("1da1"),i=n("d4ec"),s=n("bee2"),a=window.require("electron"),r=a.ipcRenderer,l=n("faa1"),c=new l.EventEmitter,u={CONNECT:"CONNECT",GET_STATUS:"GET_STATUS",CLOSE:"CLOSE"},d=function(){function t(){Object(i["a"])(this,t),r.on(u.CONNECT,(function(t,e){console.log(e)})),r.on(u.GET_STATUS,(function(t,e){c.emit(u.GET_STATUS,e)}))}return Object(s["a"])(t,[{key:"connect",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"127.0.0.1",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:9998;r.send(u.CONNECT,{token:t,binds:e,bindPort:o,bindAddr:n})}},{key:"close",value:function(){r.send(u.CLOSE,"close")}},{key:"refreshStatus",value:function(){r.send(u.GET_STATUS,"GET_STATUS")}},{key:"listenStatus",value:function(t){c.on(u.GET_STATUS,t)}},{key:"removeStatusListener",value:function(t){c.off(u.GET_STATUS,t)}}]),t}(),f=new d;setInterval(Object(o["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:f.refreshStatus();case 1:case"end":return t.stop()}}),t)}))),1e3)},e504:function(t,e,n){"use strict";(function(t){n("99af"),n("4de4"),n("7db0"),n("4160"),n("d81d"),n("b0c0"),n("a9e3"),n("9129"),n("b64b"),n("159b");var o,i=n("2909"),s=n("b85c"),a=n("ade3"),r=n("5c96"),l=n("d959"),c=n("df7c"),u=n.n(c),d=n("d54e"),f=n.n(d),p={sysu:"s.data-online.link",frp:"data-online.link"},b=new f.a({filename:u.a.resolve(t,"../../db/binds.dat"),autoload:!0}),h=new f.a({filename:u.a.resolve(t,"../../db/token.dat"),autoload:!0});window.tokenDb=h,window.db=b;var m={SSH:{port:22,host:"127.0.0.1",label:"SSH",remotePort:-1},FTP:{port:21,host:"127.0.0.1",label:"FTP",remotePort:-1},SMB:{port:445,host:"127.0.0.1",label:"SMB",remotePort:-1},RDP:{port:3389,host:"127.0.0.1",label:"RDP",remotePort:-1},HTTP:{port:80,host:"127.0.0.1",label:"HTTP",remotePort:-1},HTTPS:{port:443,host:"127.0.0.1",label:"HTTPS",remotePort:-1}};e["a"]={name:"Header",components:(o={},Object(a["a"])(o,r["Switch"].name,r["Switch"]),Object(a["a"])(o,r["CheckboxGroup"].name,r["CheckboxGroup"]),Object(a["a"])(o,r["CheckboxButton"].name,r["CheckboxButton"]),o),methods:{isInvalidIP:function(t){var e=/(\d+\.){3}\d+/,n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;return e.test(t)&&!n.test(t)},handleInlanChange:function(t){this.bindHost=t?p.sysu:p.frp,this.isOnline&&(console.log("isInLan change: ",t),l["a"].close(),l["a"].connect(this.token,this.$store.state.binds,this.bindHost,this.bindPort))},handleChangeToken:function(){var t=this;h.remove({},{multi:!0},(function(e){e||(h.insert({token:t.token},(function(){console.log("add token: ",t.token)})),t.tokenDialogVisible=!1)}))},handleAddCustomBind:function(){var t=this.customBindInput,e=t.label,n=t.host,o=t.port;if(o=parseInt(o),e)if(n)if(this.isInvalidIP(n))this.$notify.error({title:"错误",message:"ip格式错误",duration:0});else if(Number.isNaN(o)||o<0||o>65535)this.$notify.error({title:"错误",message:"端口号必须为范围在[0, 65535]的非负整数",duration:0});else{var i,a=Object(s["a"])(this.binds);try{for(a.s();!(i=a.n()).done;){var r=i.value;if(r.label===e||r.port===o&&r.host===n||e in m)return this.$notify.error({title:"错误",message:"绑定名称/主机:端口与已有绑定重复",duration:0}),void(this.customBindsDialogVisible=!0)}}catch(c){a.e(c)}finally{a.f()}var l={label:e,host:n,port:o,remotePort:-1,type:"custom"};this.customBinds.push(l),b.insert(l),this.$store.commit("addBind",l),this.customBindsDialogVisible=!1}else this.$notify.error({title:"错误",message:"主机ip/domain不能为空",duration:0});else this.$notify.error({title:"错误",message:"名称不能为空",duration:0})},handleSwitchChange:function(t){if(t){var e=this.checkProtocals.map((function(t){return m[t]})),n=[].concat(Object(i["a"])(e),Object(i["a"])(this.customBinds));this.$store.commit("replaceBinds",n),l["a"].connect(this.token,n,this.bindHost,this.bindPort)}else l["a"].close()}},computed:{binds:function(){return this.$store.state.binds},inLan:{set:function(t){this.$store.commit("toggleInLan",t)},get:function(){return this.$store.state.inLan}}},watch:{binds:function(){var t=this;console.log(this.$store.state.binds),b.remove({},{multi:!0},(function(e){if(!e){var n=t.$store.state.binds.filter((function(t){return"custom"===t.type}));b.insert(n),t.customBinds=n}})),this.isOnline&&(console.log("binds change"),l["a"].close(),l["a"].connect(this.token,this.$store.state.binds,this.bindHost,this.bindPort))}},created:function(){var t=this;h.findOne({token:/.*/},(function(e,n){console.log(n),e?console.error(e):n?t.token=n.token:t.tokenDialogVisible=!0})),this.statusListener=function(e){if(e&&e.binds){var n=t.$store.state.binds;Object.keys(e.binds).forEach((function(t){n.forEach((function(n){n.label===t&&(n.remotePort=e.binds[t].remotePort)}))})),t.$store.commit("replaceBinds",n)}while(e&&e.err.length){l["a"].close();var o=e.err.shift();t.$notify.error({title:"错误",message:o,duration:0})}var i=!(!e||!e.isOnline);t.isOnline=i},l["a"].listenStatus(this.statusListener),b.find({label:/.*/},(function(e,n){e?console.error(e):t.customBinds=n.map((function(t){return{label:t.label,host:t.label,port:t.port,remotePort:-1,type:t.type}}))}))},beforeDestroy:function(){l["a"].removeStatusListener(this.statusListener)},data:function(){return{bindHost:p.sysu,bindPort:9998,tokenDialogVisible:!1,customBinds:[],customBindsDialogVisible:!1,token:"",isOnline:!1,checkProtocals:["HTTP"],customBindInput:{label:"",host:"",port:""},protocals:[{name:"SSH",desc:"本地SSH连接(port:22)"},{name:"FTP",desc:"本地FTP连接(port:21)"},{name:"SMB",desc:"Server Message Block服务(port:445)"},{name:"RDP",desc:"本地远程桌面协议(port:3389)"},{name:"HTTP",desc:"本地HTTP服务(port:80)"},{name:"HTTPS",desc:"本地HTTPS服务(port:443)"}]}},props:{msg:String}}}).call(this,"/")}});
//# sourceMappingURL=app.1814b3fb.js.map